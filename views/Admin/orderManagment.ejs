
<%- include('partials/header') %> 

<div class="container pt-4">
    <div class="mb-3">order Managment</div>

<div class="search-wrapper">
    <input type="text" class="searchbar" id="searchOrder" placeholder="Search for orders..">
    <i class="fa fa-search search-icon"></i>
</div>


<!-- product list -->
<div class="table-responsive container border mt-2 ">
<table class="table table-striped table-sm">
    <thead>
    <tr>
        <th class="checkbox-align">
            <input type="checkbox" id="selectAll"> 
        <th scope="col">Order id </th>
        <th scope="col">ProductName</th>
        <th scope="col">Image</th>
        <th scope="col">Price</th>
        <th scope="col">quality</th>
        <th scope="col">itemTotal</th>
        <th scope="col">PaymentMethod</th>
        <th scope="col">orderStatus</th>
        <th scope="col" class="text-end">Managment</th>
    </tr>
</thead>
<tbody>
    <% orders.forEach((order) => { %>
        <% order.items.forEach((item) => { %>
          <tr class="align-middle">
            <th class="checkbox-align">
                <input type="checkbox" id="selectAll">
            </th>
           
            <td><%= order._id %></td>
            <td><%= item.productName %></td>
            <td><img src="\<%= item.image %>" alt="" style="width: 50px; height: 50px;"></td>
            <td><%= item.price %></td>
            <td><%= item.quantity %></td>
            <td><%= item.itemTotal %></td>
            <td><%= order.paymentMethod %></td>
            <td class="<% if (order.orderStatus === 'pending') { %>text-primary<% } else if (order.orderStatus === 'delivered') { %>text-success<% } else if (order.orderStatus === 'canceled') { %>text-danger<% } %>">
              <%= order.orderStatus %>
            </td> 
            <td class="">
                <div class="d-flex flex-row justify-content-end gap-4">
                    <button class="bg-warning border-0" onclick="productCancelAdm('<%=order._id %>','<%=item._id %>')">cancel</button> 
                 
                    <button class="bg-success text-white border-0" onclick="orderDelivered('<%=item._id %>')">delivered</button> 
                 </td>
        <% }) %>
        
      </tr>
      <% }) %>

   
 </tbody> 
</table>
</div>


<nav aria-label="Page navigation example">
    <ul class="pagination mt-2 justify-content-end">
        <li class="page-item <%= currentPage === 1 ? 'disabled' : '' %>">
            <a class="page-link" href="?page=<%= currentPage - 1 %>&limit=<%= limit %>" aria-label="Previous">
                <span aria-hidden="true">&laquo;</span>
                <span class="sr-only">Previous</span>
            </a>
        </li>
        <% for (let i = 1; i <= totalPages; i++) { %>
            <li class="page-item <%= currentPage === i ? 'active' : '' %>">
                <a class="page-link" href="?page=<%= i %>&limit=<%= limit %>"><%= i %></a>
            </li>
        <% } %>
    
      <li class="page-item <%= currentPage === totalPages ? 'disabled' : '' %>">
        <a class="page-link" href="?page=<%= currentPage + 1 %>&limit=<%= limit %>" aria-label="Next">
            <span aria-hidden="true">&raquo;</span>
            <span class="sr-only">Next</span>
        </a>
    </li>
    </ul>
  </nav>

</div>

<script>
    function productCancelAdm(orderId,itemId){
    try {
      fetch('/admin/cancelProductAdmin',{
        method:'POST',
        headers:{
          'Content-Type':'application/json'
        },
        body:JSON.stringify({orderId,itemId})
      })
      .then(response => response.json())
      .then(result =>{
        if(result.success){
        //   Swal.fire({
        //     icon:'success',
        //     title:'success',
        //     text: result.message,
        //     confirmButtonText:'ok'
        //     })
        alert('cancelled product')
        }else{
          Swal.fire({
            icon:'error',
            title:'error',
            text: result.message,
            confirmButtonText:'ok'
            })
        }
      })
      .catch(error => console.error('error',error))
    } catch (error) {
      console.error('someting went wrong',error)
    }
  }
</script>

<%- include('partials/footer') %>